# Система обогащения данных для HTML иерархии

## Обзор

Модуль `data` представляет собой интеллектуальную систему обогащения HTML иерархии метаданными о путях к данным, выражениях и статических значениях. Система автоматически анализирует template literals и определяет связи между HTML элементами и источниками данных.

## Основные концепции

### Обогащение иерархии

Система принимает базовую HTML иерархию и обогащает её дополнительной информацией:

- **Пути к данным**: Автоматическое определение источников данных для каждого элемента
- **Выражения**: Унификация и оптимизация условных выражений
- **Статические значения**: Выделение неизменяемых частей контента
- **Метаданные**: Дополнительная информация для рендеринга и оптимизации

### Типы узлов

Система работает с четырьмя основными типами узлов:

#### Map узлы

Представляют итерации по массивам данных. Каждый map узел содержит информацию о пути к массиву и дочерних элементах, которые будут повторены для каждого элемента массива.

#### Condition узлы

Представляют условные выражения. Система автоматически унифицирует тернарные операторы и логические выражения, создавая оптимизированные шаблоны для рендеринга.

#### Text узлы

Представляют текстовое содержимое. Могут содержать как статический текст, так и динамические переменные с путями к данным.

#### Element узлы

Представляют HTML элементы с атрибутами и дочерними узлами. Система обогащает их информацией о динамических атрибутах и содержимом.

## Логика определения путей к данным

### Абсолютные пути

Система автоматически определяет абсолютные пути к данным, начинающиеся с корневых контекстов:

- Пути к данным из основного контекста приложения
- Пути к глобальным переменным и состояниям
- Ссылки на внешние источники данных

### Относительные пути

В контексте вложенных структур система создает относительные пути, используя специальные маркеры:

- `[item]` - текущий элемент массива
- `[index]` - индекс текущего элемента
- `../` - переход на уровень выше в иерархии

### Контекстная навигация

Система поддерживает сложную навигацию по вложенным структурам данных:

- Автоматическое определение уровня вложенности
- Правильное разрешение путей между разными уровнями
- Поддержка произвольной глубины вложенности

## Обработка параметров map функций

### Простые параметры

Когда map функция принимает один параметр, система интерпретирует его как сам элемент массива. Это подходит для массивов примитивов (строк, чисел).

### Деструктурированные параметры

При использовании деструктуризации система автоматически определяет свойства объектов и создает соответствующие пути к данным. Это позволяет работать с массивами объектов.

### Параметры с индексами

Система поддерживает дополнительные параметры для доступа к индексам элементов. Второй и последующие параметры автоматически интерпретируются как индексы.

### Универсальность путей

Ключевая особенность системы - универсальность путей к данным. Независимо от способа доступа к данным (деструктуризация или доступ по ключу), система генерирует одинаковые пути, обеспечивая консистентность.

## Вложенные контексты

### Иерархия контекстов

Система создает иерархию контекстов для каждого уровня вложенности map функций. Каждый контекст содержит информацию о параметрах и уровне вложенности.

### Разрешение переменных

При поиске переменных система использует стек контекстов, начиная с самого глубокого уровня и поднимаясь к корню. Это обеспечивает правильное разрешение переменных в сложных вложенных структурах.

### Относительные ссылки

Система автоматически вычисляет количество уровней подъема для доступа к переменным из внешних контекстов, создавая корректные относительные пути.

## Унификация выражений

### Тернарные операторы

Система автоматически унифицирует тернарные выражения, удаляя избыточные пробелы и переносы строк, но сохраняя строковые литералы. Это улучшает читаемость и производительность.

### Логические выражения

Сложные логические выражения автоматически оптимизируются и приводятся к единому формату для эффективного рендеринга.

### Кэширование шаблонов

Унифицированные выражения могут быть кэшированы независимо от конкретных данных, что значительно повышает производительность при повторном рендеринге.

## Форматирование текста

### HTML стандарты

Система применяет стандарты HTML для форматирования текста:

- Схлопывание последовательных пробельных символов
- Правильная обработка переносов строк
- Сохранение значимых пробелов в строковых литералах

### Оптимизация производительности

Автоматическое форматирование не только улучшает читаемость, но и оптимизирует производительность рендеринга за счет уменьшения размера DOM.

## Алгоритм работы

### Анализ template literals

Система анализирует template literals, извлекая:

- Статические части текста
- Динамические выражения
- Условные конструкции
- Итерации по массивам

### Построение иерархии

На основе анализа создается обогащенная иерархия с метаданными о:

- Путях к данным
- Типах узлов
- Связях между элементами
- Контекстах выполнения

### Разрешение зависимостей

Система автоматически разрешает зависимости между переменными и источниками данных, создавая оптимальные пути для доступа к информации.

## Преимущества системы

### Производительность

- Кэширование унифицированных выражений
- Оптимизация путей к данным
- Минимизация повторных вычислений

### Гибкость

- Поддержка произвольной глубины вложенности
- Универсальные пути независимо от способа доступа
- Автоматическое определение контекстов

### Надежность

- Автоматическое разрешение конфликтов имен
- Корректная обработка edge cases
- Обратная совместимость

### Расширяемость

- Модульная архитектура
- Поддержка новых типов узлов
- Возможность добавления кастомных обработчиков

## Применение

Система предназначена для использования в современных веб-приложениях, где требуется:

- Динамический рендеринг на основе данных
- Сложные условные конструкции
- Итерации по вложенным структурам
- Оптимизация производительности рендеринга

Система особенно эффективна в контексте компонентных архитектур и реактивных фреймворков, где важна производительность и предсказуемость поведения.
