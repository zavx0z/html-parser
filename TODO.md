# TODO

## Проблема с двойными фигурными скобками в сложных строках с условными выражениями

### Описание проблемы

При обработке сложных строк с несколькими `${}` выражениями, содержащими условные операторы, функция `createUnifiedExpression` добавляет лишние фигурные скобки.

### Пример

**Входные данные:**

```html
<div class="user-${core.user.id}-${core.user.role}-${core.theme}-${core.isActive ? "active" : "inactive"}"></div>
```

**Ожидаемый результат:**

```javascript
expr: 'user-${0}-${1}-${2}-${3 ? "active" : "inactive"}'
```

**Фактический результат:**

```javascript
expr: 'user-${0}}-${${1}}-${${2}}-${${3} ? "active" : "inactive"'
```

### Причина проблемы

Когда мы заменяем `${core.user.id}` на `${0}`, но при этом мы уже находимся внутри `${}`, получается `${${0}}`.

### Возможные решения

1. **Заменить только содержимое `${}`**: Вместо замены `${core.user.id}` на `${0}`, заменить `core.user.id` на `0` внутри существующих `${}`.
2. **Защитить условные выражения**: Сначала найти и защитить `${}` выражения с условными операторами, затем обработать остальные переменные.
3. **Изменить логику парсинга**: Обрабатывать сложные строки с несколькими `${}` выражениями по-другому.

### Файлы для изменения

- `data.ts` - функция `createUnifiedExpression`
- `data.ts` - функция `parseTemplateLiteral` (ветка с условными выражениями)

### Тест

- `tests/data/class.spec.ts` - "class в элементе со сложной строкой с условными выражениями"

### Приоритет

Средний - влияет на корректность обработки сложных строк с условными выражениями в атрибутах `class`.
